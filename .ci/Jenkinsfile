pipeline {
    agent any
    options {
        ansiColor('xterm')
        buildDiscarder(logRotator(numToKeepStr: '5', artifactNumToKeepStr: '5'))
    }

    stages {

        stage('check parameters') {
            when {
                anyOf {
                    expression { env.TEST_NAME == null }
                }
            }
            steps {
                error('Please select an operator using the environment variable TEST_NAME')
            }
        }

        stage('prepare test run') {
            steps {
                sh """
                    echo Prepare to run test '${env.TEST_NAME}'
                    echo Jenkins workspace is here: ${env.WORKSPACE}
                    export HOST_WORKSPACE=`echo ${env.WORKSPACE} | sed 's~jenkins_home~jenkins/data~'`
                    echo neu nun: ${env.HOST_WORKSPACE}
                """
                hostWorkspace = sh(script: 'echo hurz', returnStdout: true).trim()
                env.KRAM = hostWorkspace
                sh """
                    echo KRAM: ${env.KRAM}
                """
            }
        }

        // stage('print parameters') {
        //     when {
        //         allOf {
        //             expression { env.STACKABLE_OPERATOR != null }
        //         }
        //     }
        //     steps {
        //         echo "Testing the operator: ${env.STACKABLE_OPERATOR}"
        //     }
        // }

        // stage('print folder content') {
        //     steps {
        //         sh """
        //             cd .ci/
        //             rm -rf target/ || true
        //             mkdir target/
        //             docker run \
        //                 docker.stackable.tech/ci-preprocessor:latest
        //         """
        //     }
        // }

    }
}


